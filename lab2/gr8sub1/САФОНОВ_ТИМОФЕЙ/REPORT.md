# Лабораторная работа №2 — Процессы и файловая система `/proc`

## Цель работы
- Освоить модель процессов Linux.  
- Разобраться в механизме порождения и ожидания завершения процессов.  
- Научиться извлекать информацию о процессах из виртуальной файловой системы `/proc`.

---

## Ход выполнения

### 1. Создание процессов
В папке `src` была написана программа **process.c**, которая создает один родительский процесс и два дочерних.  
Родитель ожидает завершения дочерних, а затем корректно завершает работу.  

Компиляция:
```bash
gcc -o process process.c
```

Результат работы программы:  
![Вывод программы](image.png)

---

### 2. Исследование дерева процессов
1. Использован конвейер:
   ```bash
   ps -ef --forest | head -n 30 | cat
   ```
   ![Вывод ps](image-1.png)  

   Здесь не видно процессов программы, так как они завершились слишком быстро. `ps` показывает только активные процессы.  

2. Использован конвейер:
   ```bash
   pstree -p | head -n 50 | cat
   ```
   ![Вывод pstree](image-2.png)  

   `pstree` отображает процессы в виде дерева, что нагляднее по сравнению с таблицей `ps`.

---

### 3. Изучение `/proc`
1. Определение PID текущей оболочки:  
   ![PID bash](image-3.png)

2. Выполнены команды:
   ```bash
   cat /proc/<pid>/cmdline | tr '\0' ' '; echo
   head -n 20 /proc/<pid>/status
   ls -l /proc/<pid>/fd
   ```

   - `cmdline` — показывает команду запуска процесса.  
     ![cmdline](image-4.png)  

   - `status` — краткая сводка информации о процессе (первые 20 строк).  

   - `fd` — список файловых дескрипторов, открытых процессом.  
     ![fd](image-5.png)

---

### 4. Анализ процессов (CPU / память / I/O)

**TOP-5 по CPU**  
![CPU топ-5](image-6.png)

Причины:
- `ps` — сам инструмент мониторинга на мгновение загрузил CPU.  
- `gnome-shell` — рендеринг интерфейса рабочего стола.  
- Браузеры (`firefox`, `Isolated Web Co`, `RDD Process`) — активно используют ресурсы для рендеринга, JS, видео.  

**TOP-5 по памяти**  
![MEM топ-5](image-7.png)

Причины:
- Firefox (~579 MiB) — лидер по потреблению памяти.  
- GNOME (~426 MiB) — графическая оболочка.  
- Изолированные процессы браузера (~500 MiB в сумме).  
- VS Code (~178 MiB) — тяжелый редактор с расширениями.  

**Итог:**
- Основной потребитель CPU — браузеры.  
- Основные потребители памяти — браузеры и графическая оболочка GNOME.  

---

### 5. Мини-утилита `ptree` (*)
Была реализована программа **chain.c**, которая отображает дерево процессов.  

Компиляция:
```bash
gcc -o chain chain.c
```

Результат:  
![ptree](image-8.png)

---

## Ключевые выводы
- Изучен механизм работы процессов в Linux.  
- Найдены наиболее ресурсоемкие процессы по CPU и памяти.  
- Освоена работа с языком C для создания процессов.  
- Получены навыки чтения информации из `/proc`.

---

## Ответы на вопросы

1. **Чем процесс отличается от программы?**  
   - Программа — статичный файл на диске.  
   - Процесс — выполняющийся экземпляр программы в памяти.  

2. **Что будет, если вызвать `fork()` без `wait()`?**  
   - Родитель не узнает статус завершения дочернего процесса.  
   - Дочерний процесс после завершения станет «зомби».  

3. **Как система хранит информацию о процессах?**  
   - В ядре Linux — в структуре `task_struct`.  
   - Доступ пользователю: `/proc`, системные вызовы (`getpid()`, `getppid()`), утилиты (`ps`, `top`, `htop`).  

4. **Что делает `exec()` и зачем он нужен?**  
   - Заменяет образ процесса на новый.  
   - Используется после `fork()`, чтобы запустить другую программу.  

5. **Почему в `/proc` нет настоящих файлов?**  
   - `/proc` — виртуальная ФС. Данные создаются ядром при обращении.  

6. **Интерпретация полей `top`:**
   - `%CPU` — процент использования CPU.  
   - `%MEM` — доля физической памяти.  
   - `VIRT` — виртуальная память.  
   - `RES` — фактически используемая RAM.  
   - `SHR` — разделяемая память.  
   - `TIME+` — суммарное время CPU.  

7. **Почему сумма `%CPU` может быть >100%?**  
   - Каждое ядро считается отдельно. При многопоточности сумма превышает 100%.  

8. **Отличие `%CPU` от load average?**  
   - `%CPU` — мгновенная загрузка.  
   - `Load Average` — среднее количество процессов в очереди за 1, 5, 15 минут.  

9. **Чем отличается CPU-нагрузка от IO-нагрузки?**  
   - CPU — активное использование процессора.  
   - IO — ожидание операций с диском/сетью.  
   - Инструменты: `pidstat -d`, `iotop`, `/proc/<pid>/io`.  

10. **Что такое nice/приоритет?**  
    - Диапазон: `-20` (высокий приоритет) до `19` (низкий).  
    - Влияет на планирование процессов.  

11. **Чем поток отличается от процесса?**  
    - Поток — единица выполнения внутри процесса, разделяет память.  
    - Просмотр: `ps -eLf`, `top -H`, `htop`.  

12. **Что такое зомби и сироты?**  
    - Зомби — завершенные процессы без `wait()`.  
    - Сироты — процессы без родителя, усыновляются `init/systemd`.  

---

## Проверка работы
1. Запуск программ и команд в терминале Ubuntu.  
2. Получение результатов и их анализ.  

---

## Использование AI
- Инструмент: **Deepseek**.  
- Помощь в:
  - написании кода на C,  
  - интерпретации таблиц CPU/памяти,  
  - формулировке ответов на вопросы.  

---

## Используемое ПО
- Ubuntu 24.04.3 LTS  
