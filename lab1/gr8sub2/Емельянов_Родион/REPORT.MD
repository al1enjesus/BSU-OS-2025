# Лабораторная работа 1. Bash: анализ логов

## Цель работы
Освоить базовые инструменты командной строки Linux для навигации, поиска, фильтрации и анализа текстовых данных на примере системных логов.

## Задание A. Частотный анализ слов в syslog (TOP‑5)

**Цель:** Подсчитать 5 самых частых слов в системном логе, игнорируя регистр.

**Шаги и решение:**
1.  **Чтение файла:** `cat /var/log/syslog`
2.  **Нормализация текста:** 
    *   `tr -cs '[:alpha:]' '\n'` - заменяет все небуквенные символы на перевод строки, эффективно разбивая текст на слова
    *   `tr '[:upper:]' '[:lower:]'` - приводит все символы к нижнему регистру
3.  **Сортировка и подсчет:** 
    *   `sort` - сортирует слова по алфавиту
    *   `uniq -c` - подсчитывает количество уникальных вхождений
4.  **Сортировка по количеству и вывод ТОП-5:**
    *   `sort -nr` - сортирует результат по числовому значению (`-n`) в обратном порядке (`-r`), от большего к меньшему
    *   `head -n 5` - выводит первые 5 строк

**Итоговая команда:**
```bash
cat /var/log/syslog | tr -cs '[:alpha:]' '\n' | tr '[:upper:]' '[:lower:]' | sort | uniq -c | sort -nr | head -n 5
```

**Результат:**
```
    17924 ubuntu
    17566 t
    17489 vm
    7069 gnome
    6622 systemd
```
**Вывод:** 
Самыми частыми словами в системном логе: `ubuntu` - название ОС, `t` и `vm` - то, что система загружена в виртуальной машине, `gnome` - графическая среда Ubuntu, `systemd` - системный менеджер и демон инициализации, который управляет загрузкой и работой всех служб.

---

## Задание Б. Неудачные попытки входа (auth.log)

**Цель:** Найти TOP-10 IP-адресов, с которых происходили неудачные попытки входа, и замаскировать последний октет.

**Шаги и решение:**

1.  **Поиск неудачных попыток:**
    *   `grep -iE '(failed|invalid)' /var/log/auth.log` - ищем все строки, содержащие слова "failed" или "invalid" в любом регистре (`-i`), используя расширенный regex (`-E`).

2.  **Извлечение IP-адресов:**
    *   `grep -Eo '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+'` - из найденных строк извлекаем только последовательности, похожие на IP-адреса. Ключ `-o` выводит только совпавшую часть строки.

3.  **Подсчет TOP-10 адресов:**
    *   `sort | uniq -c | sort -nr | head -n 10` - стандартная цепочка для подсчета и сортировки по популярности.

4.  **Маскировка последнего октета:**
    *   `sed -E 's/([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+/\1x/g'` - ищем в тексте IP-адрес, группируя первые три октета (`\1`), и заменяем весь адрес на сгруппированную часть + `.x`.

**Итоговая команда:**
```bash
grep -iE '(failed|invalid)' /var/log/auth.log | grep -Eo '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' | sort | uniq -c | sort -nr | head -n 10 | sed -E 's/([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+/\1x/g'
```

**Результат:**
``` 
```
Вывод пуст, т.к. никто не подключался по ssh. Вместо этого найдем и подсчитаем неудачные попытки входа для пользователя `daberauoy` (мой пользователь).

1.  **Поиск неудачных попыток:** `grep -iE '(failed|invalid)' /var/log/auth.log` - находим все записи о неудачных попытках аутентификации.
2.  **Фильтрация по пользователю:** `grep -i daberauoy` - фильтруем результат, оставляя только попытки, связанные с пользователем `daberauoy`.
3.  **Подсчет количества:** `wc -l` - подсчитываем количество строк в результате, которое равно количеству неудачных попыток.

**Итоговая команда:**
```bash
grep -iE '(failed|invalid)' /var/log/auth.log | grep -i daberauoy | wc -l
```
**Результат:**
``` 
1
```

**Вывод:** Была зафиксирована одна неудачная попытка входа.

---

## Задание В. Установки пакетов (dpkg.log)

**Цель:** Определить TOP-10 самых часто устанавливаемых пакетов.

**Шаги и решение:**

1.  **Поиск событий установки:**
    
    `grep 'install ' /var/log/dpkg.log` - ищем строки, содержащие слово "install ". Важно добавить пробел, чтобы избежать совпадения с "installed" или другими формами.

2.  **Извлечение имен пакетов:**
    
    `awk '{print $4}'` - в логе `dpkg.log` имя устанавливаемого пакета находится в четвертой колонке.

3.  **Подсчет TOP-10 пакетов:**

    Т.к. формат строк в логах типа `libjpeg-turbo8:amd64`, разделим по `:` и `-` и подсчитаем по первому слову:
    
    `sort | cut -d ':' -f1 | cut -d '-' -f1 | uniq -c | sort -nr | head -n 10` - сортировка и подсчет, вывод топ-10.

**Итоговая команда:**
```bash
grep 'install ' /var/log/dpkg.log | awk '{print $4}' | sort | cut -d ':' -f1 | cut -d '-' -f1 | uniq -c | sort -nr | head -n 10
```

**Результат:**
```
     76 python3
     46 gnome
     46 gir1.2
     34 language
     19 libxcb
     18 xserver
     18 ubuntu
     15 linux
     15 ibus
     13 printer
```
**Вывод:** Чаще всего устанавливались базовые пакеты, связанные с Linux и его системой и python.

---

## Как проверял
*   **Проверка воспроизводимости:** Все команды последовательно запускались в терминале Ubuntu 24.04.3. Результаты записывались в отчет и дополнительно в текстовые файлы.
*   **Верификация данных:** Для проверки правильности работы команд они запускались по отдельности для каждой команды в цепочке.

## Использование AI
*   **DeepSeek:** Помог уточнить синтаксис regex для маскировки IP-адреса, а именно `([0-9]+\.[0-9]+\.[0-9]+\.)` и использование `\1` для обратной ссылки.
*   **Markdown:** Помощь с составлением Markdown страницы лабораторной работы.
*   **bash** Помощь в подробном объяснении всех неоюходимых команд.