# лабораторная 1 — bash: анализ логов

## окружение

```
Ubuntu 25.04 (VirtualBox)
GNU bash, версия 5.2.37(1)-release
```

использованные логи: `/var/log/syslog`, `/var/log/auth.log`, `/var/log/dpkg.log`

## цель работы

научиться работать с базовыми инструментами просмотра, поиска, фильтрации и парсинга информации на примере системных логов в linux.

## задача А - топ-5 слов в syslog

выполненные команды:

```bash
# читаем весь файл
cat /var/log/syslog |
	# удаляем все не-числа и не-буквы
	# и заменяем их символом новой строки
	tr -cs '[:alnum:]' '\n' |
	# (по желанию можно исключить временные метки или числа в принципе)
	grep -xvE '[0-9]+' |
	# приводим всё к нижнему регистру
	tr '[:upper:]' '[:lower:]' |
	# лексиграфически сортируем
	sort |
	# считаем кол-во повторений слов
	uniq -c |
	# теперь сортируем по числу в начале строки
	sort -nr |
	# выводим первые 5 строк (результатов)
	head -n 5
```

результат (без фильтрации чисел):

```
  11367 00
   8905 09
   8704 2025
   8692 virtualbox
   8637 vboxuser
```

результат (с фильтрацией чисел):

```
  11042 virtualbox
  10988 vboxuser
   4547 gnome
   4353 systemd
   3705 service
```

### вывод

чаще всего встречаются временные марки, сообщения от драйвера virtualbox (виртуальной машины), а также от пользователя (vboxuser).

## задание Б - неудачные попытки входа

искать ip-адреса в данном задании нецелесообразно, так как используется свежая виртуальная машина, доступ к которой имеет только один компьютер (хост), из-за чего в сумме выйдет только топ-1 адресов. вместо этого будет подсчитано кол-во неудачных попыток входа локальных пользователей.

выполненные команды:

```bash
echo "unsuccessful login attempts:"
# читаем весь файл
cat /var/log/auth.log |
        # ищем строку, которая сообщает об ошибке, и извлекаем logname
        grep -aoP 'authentication failure; logname=(.*) uid' |
        # убираем ненужные куски строки
        sed "s/authentication failure; logname=//g" |
        sed "s/uid//g" |
        # лексикографически сортируем
        sort |
        # подсчитываем кол-во повторений
        uniq -c |
        # если было введено неизвестное имя пользователя,
        # то logname будет пусто, заменяем на более понятное сообщение
        sed -E "s/([0-9])  +/\1 invalid username/g" |
        # сортируем по кол-ву попыток
        sort -nr
```

результат:

```
unsuccessful login attempts:
      5 invalid username
      3 vboxuser 
```

## задание В - топ-10 по установке пакетов

выполненные команды:

```bash
# читаем весь файл и ищем появление ивентов установки пакетов
grep 'install ' /var/log/dpkg.log |
        # извлекаем название пакета
        awk '{print $4}' |
        # лексикографически сортируем
        sort |
        # считаем кол-во повторений
        uniq -c |
        # сортируем по кол-ву повторений
        sort -nr |
        # выводим первые 10 результатов
        head -n 10
```

результат:

```bash
      1 zstd:amd64
      1 zlib1g:amd64
      1 zip:amd64
      1 zenity-common:all
      1 zenity:amd64
      1 yelp-xsl:all
      1 yelp:amd64
      1 yaru-theme-sound:all
      1 yaru-theme-icon:all
      1 yaru-theme-gtk:all
```

### вывод

ничего интересного, т.к. система была недавно обновлена и перезапущена.

## ключевые выводы

вместо того чтобы копаться в логах через блокнот и искать нужную информацию, есть возможность быстро фильтровать/преобразовывать информацию через инструменты, предоставленные вместе с ядром linux.

## как использовался ии

никак.

