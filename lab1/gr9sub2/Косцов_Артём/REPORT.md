# Лабораторная 1 — Анализ логов в Bash

Краткая практика по работе с файлами логов в Linux с использованием базовых инструментов командной строки.

## Цели

- Изучить базовые инструменты для работы с командной строкой на примере текстовых файлов (логов).
- Научиться строить конвейеры для решения практических задач.

## Задания

### А) Частотный анализ слов в syslog (TOP-5)

**Цель**: Подсчитать 5 самых частых слов в системном логе, нормализовав регистр и разделители.

#### Шаги/решения:

1. Чтение файла syslog.
2. Перевод всех символов в нижний регистр.
3. Разделение текста на слова (замена не-буквенно-цифровых символов на переносы строк).
4. Сортировка слов.
5. Подсчет уникальных вхождений.
6. Сортировка по количеству (по убыванию).
7. Вывод первых 5 результатов.

#### Команда:

```bash
cat syslog \
  | tr '[:upper:]' '[:lower:]' \
  | tr -cs '[:alnum:]' '\n' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```

#### Результат:

```
  63053 00
  58208 09
  53032 discessit
  53017 2025
  53006 xx
```

#### Выводы:

Самые частые слова в syslog — это элементы временных меток и системные идентификаторы. Часто встречается имя пользователя, так как многие системные события связаны с сессией пользователя.

#### Использование ИИ:

Гайд по командам, предоставляющий более объемные примеры.

### Б) Неудачные попытки входа (auth.log)

**Цель**: Найти попытки неудачного входа, извлечь IP-адреса источников, замаскировать последний октет, определить TOP-10, а также определить имена пользователей, к которым пытались подключиться, и вывести время каждой попытки.

#### Шаги/решения:

1. Поиск строк с "Failed" или "Invalid" в auth.log.
2. Извлечение IP-адресов.
3. Маскировка последнего октета.
4. Подсчет частоты появления каждого маскированного IP.
5. Сортировка по убыванию частоты.
6. Вывод TOP-10.
7. Поиск строк с ошибками авторизации и их вывод.

#### Команда для IP-адресов:

```bash
cat auth.log \
  | grep -E 'Failed|Invalid' \
  | grep -o -E '([0-9]{1,3}\.){3}[0-9]{1,3}' \
  | sed -E 's/([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+/\1x/g' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

#### Результат:

Отсутствие вывода.

#### Выводы:

Неудачные входы в систему по SSH отсутствуют. К компьютеру подключались только локально.

#### Проверка:

Был создан тестовый файл `_auth.log` с данными о неправильных входах.

#### Тестовая команда:

```bash
echo "Jan 1 10:00:01 server sshd[12345]: Failed password for root from 192.168.1.15 port 22 ssh2
Jan 1 10:00:03 server sshd[12346]: Invalid user admin from 10.0.0.27
Jan 1 10:00:05 server sshd[12347]: Failed password for invalid user test from 172.16.254.3 port 22 ssh2
Jan 1 10:02:01 server sshd[12348]: Failed password for root from 192.168.1.15 port 22 ssh2" > test_auth.log
```

#### Результат:

```
  2 192.168.1.x
  1 172.16.254.x
  1 10.0.0.x
```

#### Выводы:

Команда работает корректно, но в реальном логе неудачные входы отсутствуют.

#### Команда для поиска ошибок авторизации:

```bash
cat auth.log \
  | grep 'authentication failure' \
  | awk '{print $1, $2, $3, $13}'
```

#### Результат:

```
2025-09-01T19:39:29.123039+03:00 discessit-MCLF-XX gdm-password]: user=discessit
2025-09-02T11:00:19.164233+03:00 discessit-MCLF-XX gdm-password]: user=discessit
2025-09-06T09:12:01.082039+03:00 discessit-MCLF-XX gdm-password]: user=discessit
2025-09-14T11:58:18.975574+03:00 discessit-MCLF-XX gdm-password]: user=discessit
2025-09-14T11:58:24.530322+03:00 discessit-MCLF-XX gdm-password]: user=discessit
```

#### Выводы:

Неудачных попыток входа немного, вероятно, на компьютере используется только один пользователь.

#### Использование ИИ:

Помощь с командами для анализа IP-адресов и поиска ошибок авторизации. Генерация тестовых ошибок для логов.

### В) Установки пакетов (dpkg.log)

**Цель**: Определить TOP-10 пакетов по количеству установок из лога dpkg.log.

#### Шаги/решения:

1. Поиск событий установки пакетов.
2. Извлечение имен пакетов.
3. Подсчет количества установок.
4. Сортировка по количеству установок (по убыванию).
5. Вывод TOP-10 результатов.

#### Команда:

```bash
cat dpkg.log \
  | grep 'status installed' \
  | awk '{print $5}' \
  | cut -d: -f1 \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

#### Результат:

```
  19 libc-bin
  13 man-db
   7 libglib2.0-0t64
   7 dbus
   5 sgml-base
   5 gnome-menus
   5 desktop-file-utils
   4 systemd
   4 install-info
   4 hicolor-icon-theme
```

#### Выводы:

В установке лидируют системные библиотеки. Большинство установленных пакетов являются зависимостями других пакетов.

#### Использование ИИ:

Помощь с командами.

### Проверка результатов

1. **Сравнение с тестовыми файлами**: Для auth.log был создан искусственный лог с примерами неправильных входов, чтобы убедиться, что команды корректно находят и маскируют IP-адреса.
2. **Валидация по здравому смыслу**: Частотный анализ syslog показал, что наиболее частые слова связаны с временными метками — это ожидаемый результат.
3. **Повторные запуски**: Команды запускались несколько раз для проверки стабильности вывода и отсутствия случайных артефактов.

## Итоги

Выполненная работа доказала, что базовые инструменты Bash позволяют эффективно решать задачи мониторинга, безопасности и анализа работы операционной системы.
