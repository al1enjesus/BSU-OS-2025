## Лабораторная 1 - Bash: анализ логов
Короткая практика по работе с файлами логов в Linux с использованием базовых инструментов командной строки.
 
## Цели
Познакомиться с базовыми инструментами командной строки для анализа файлов логов в Linux.

## Сведения о среде

- Дистрибутив: Kali Linux 2024.2
- Версия ядра: `uname -r` → `6.6.0-kali3-amd64`
- Доступные логи:
  - `/var/log/syslog`
  - `/var/log/auth.log`
  - `/var/log/dpkg.log`
- Все команды выполнялись от обычного пользователя с правами `sudo`.

## Задание А
Необходимо подсчитать 5 самых частых “слов” в `/var/log/syslog`.

### Шаги                        
1. `cat /var/log/syslog` — выводит содержимое файла.
2. `tr -cs '[:alpha:]' '\n'` — разбивает текст на слова, оставляя только буквы.
3. `tr '[:upper:]' '[:lower:]'` — переводит все буквы в нижний регистр.
4. `awk 'length($0) > 1'` — убирает слова длиной 1 символ.
5. `sort` — сортирует слова по алфавиту.
6. `uniq -c` — считает количество повторений каждого слова.
7. `sort -nr` — сортирует по убыванию количества.
8. `head -n 5` — выводит первые 5 строк (топ-5 слов)

### Решение

```bash
cat /var/log/syslog \
  | tr -cs '[:alpha:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | awk 'length($0) > 1' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5


```
После выполнения команды, ожидаемый результат:

```
   3231 kali
   1957 kernel
    816 systemd
    717 service
    378 daemon
```
### Как проверяли

- Сравнили результат `cat /var/log/syslog | ...` с ручным просмотром через `less /var/log/syslog`.
- Проверили, что слово `kali` действительно часто встречается в начале строк (`hostname`).
- Убедились, что команды не содержат лишней фильтрации, повлияющей на результат.


### Вывод
`kali` - название хоста, а так же имя пользователя,  является самым часто употребляемым, на втором месте идёт название ядра `kernel` оно часто встречается в упоминании процессов. Третье место по популярности занимает системный менеджер `systemd`, отвечающий за запуск, остановку и мониторинг сервисов и процессов. На четвёртом разместились сами сервисы `service`. На пятом месте в рейтенге `daemon` - фоновый процесс.

### Как использовали AI
Подсказка как использовать команду `awk`, а также со значением и флагами основных команд. Так же искусственный интелект объяснил, за что отвечают слова выведенные в результате выполнения команды.

## Задание Б
Неудачные попытки входа (auth.log)
- Найти строки с Failed или Invalid в `/var/log/auth.log`.
- Извлечь IP‑адреса, посчитать TOP‑10 источников.
- Замаскировать последний октет IP (например, `192.168.0.15` → `192.168.0.x`) с помощью `sed`. 

### Решение
Найдём все строки с Failed или Invalid, или authentication failure, и извлекём IP-адреса. Сразу зашифруем последний октет с помощью sed. Далее группируем наши слова и считаем частоты, далее численно сортируем по убыванию, и выводим первые 10.

```bash
grep -Ei 'Failed|Invalid|authentication failure' /var/log/auth.log \
  | grep -Eoi 'from[[:space:]]+([0-9]{1,3}\.){3}[0-9]{1,3}|from[[:space:]]+([0-9a-f:]+)|rhost=([0-9]{1,3}\.){3}[0-9]{1,3}' \
  | sed -E 's/^[^0-9a-f:]*//I' \
  | sed -E 's/(([^.]*\.){3})[^.]+/\1x/; s/(:[^:]+)$/:xxxx/' \
  | sort | uniq -c | sort -nr | head -n 10

```
Так как никто не подключался по ssh результата не будет. Вместо этого можем найти количество неудачных попыток для пользователя `kali`

```bash
grep -Ei 'Failed|Invalid|authentication failure' /var/log/auth.log | grep kali | wc -l

```
После введения команды ожидается реузльтат:

```
27
```
### Вывод
Основное задание выполнить не удалось. Но как альтернативу ему был выполнен подсчёт неуачных входов для пользлвателя `kali`.

## Задание В
Установки пакетов (dpkg.log)
- По /var/log/dpkg.log посчитайте, какие пакеты устанавливались чаще всего.
- Выведите TOP‑10 пакетов с количеством установок.

### Решение 

1. Просмотрим первые 8 строки в dpkg.log для нахождения критериев поиска.
```bash
head -n 8 /var/log/dpkg.log

```
Полученный результат:
```
2024-11-30 12:14:12 startup archives install
2024-11-30 12:14:12 install base-passwd:amd64 <none> 3.6.5
2024-11-30 12:14:12 status half-installed base-passwd:amd64 3.6.5
2024-11-30 12:14:12 status unpacked base-passwd:amd64 3.6.5
2024-11-30 12:14:12 configure base-passwd:amd64 3.6.5 3.6.5
2024-11-30 12:14:12 status half-configured base-passwd:amd64 3.6.5
2024-11-30 12:14:12 status installed base-passwd:amd64 3.6.5
2024-11-30 12:14:12 startup archives install

```
### Шаги
1. В логах `/var/log/dpkg.log` имя установленного пакета — это 4-й токен в строке.
2. Сначала с помощью `grep ' install '` фильтруем только строки с установками пакетов.
3. Затем `awk '{print $4}'` выводит только имена пакетов.
4. `sort | uniq -c` группирует одинаковые имена и подсчитывает количество установок каждого.
5. `sort -nr` сортирует результат по убыванию количества.
6. `head -n 10` выводит топ‑10 самых часто устанавливаемых пакетов.

```bash
grep ' install ' /var/log/dpkg.log | awk '{print $4}' | sort | uniq -c | sort -nr | head -n 10

```
После выполнениея команды ожидаемый вывод:
```
      1 zstd:amd64
      1 zsh-syntax-highlighting:all
      1 zsh-common:all
      1 zsh-autosuggestions:all
      1 zsh:amd64
      1 zlib1g-dev:amd64
      1 zlib1g:amd64
      1 zipcmp:amd64
      1 zip:amd64
      1 zenmap:all
```
## Как проверяли

- Запускали команды с `grep` и проверяли вручную, какие IP встречаются чаще.
- Протестировали `sed` на отдельных строках, чтобы убедиться, что маскирование IP работает.
- Проверили, что пользователь `kali` действительно упоминается в строках с ошибками.

### Вывод
Так как пакеты устанавливались только один раз, повторы могут быть только при переустановках.
 
## Общие выводы
В ходе лабораторной работы, я освоил базовые интсрументы командной строки для анализа логов в Linux.
