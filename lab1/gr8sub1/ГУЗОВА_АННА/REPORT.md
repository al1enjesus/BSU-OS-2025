# Лабораторная 1 — Bash: анализ логов

Краткая тренировка по обработке системных логов Linux с помощью базовых утилит командной строки.

### Цели

Освоить построение конвейеров в Bash для разбора текстовых логов: фильтрация, агрегации, извлечение полей и сортировка результатов.

### Среда и данные
ОС: Linux Debian
Основные логи:
```
/var/log/syslog
/var/log/auth.log
/var/log/dpkg.log
```

### Инструменты
Навигация/просмотр: `pwd, ls -lah, cd, cat, less, head, tail -n 50, tail -f`
Поиск и фильтрация: `grep, grep -i, grep -E, grep -v`
Агрегации/парсинг: `wc -l, sort, uniq -c, cut, awk, sed`
Конвейеры/перенаправления:` |, >, >>, 2>`

## Задания

A) Частотный анализ слов в `syslog` (TOP-5)
Определить 5 самых частых «слов» в системном логе после нормализации регистра и разделителей.

Шаги/решение.

- Прочитать лог.
- Перевести символы в нижний регистр.
- Разбить поток на слова по всем небуквенно-цифровым символам.
- Отсортировать, посчитать частоты, отсортировать по убыванию.
- Взять TOP-5.

Команда:

```
cat /var/log/syslog \
  | tr -cs '[:alnum:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```

Результат:

>     735 00
>     582 linux
>     581 03
>     576 2025
>     575 09

    
**Вывод:**
Чаще всего всплывают токены из временных меток/идентификаторов. Также упоминается слово `linux`. Скорее всего как название моей машины.

**Использование ИИ:**
Подсказки по построению конвейера и нормализации текста `tr + uniq -c`.

Б) Неудачные попытки входа (`auth.log`)
Найти все строки с Failed или Invalid в `auth.log`, извлечь IPv4-адреса, замаскировать последний октет и вывести TOP-10 источников.

Шаги/решение.

- Отфильтровать строки с неуспешной аутентификацией.
- Достать только IPv4.
- Спрятать последний октет x.
- Посчитать частоты и отсортировать по убыванию.
- Взять TOP-10.

Команда:

```
cat /var/log/auth.log \
  | grep -E 'Failed password|Invalid user|authentication failure|password check failed|conversation failed' \
  | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' \
  | sed -E 's/\.[0-9]+$/.x/g' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

В моем auth.log нет IpV4 адресов, поэтому команда ничего не выводит. Для проверки работоспособности конвейера, проверим его на тестовом файле

```
cat > test_auth.log <<'EOF'
Jan 1 10:00:01 server sshd[12345]: Failed password for root from 192.168.1.15 port 22 ssh2
Jan 1 10:00:03 server sshd[12346]: Invalid user admin from 10.0.0.27
Jan 1 10:00:05 server sshd[12347]: Failed password for invalid user test from 172.16.254.3 port 22 ssh2
Jan 1 10:02:01 server sshd[12348]: Failed password for root from 192.168.1.15 port 22 ssh2
EOF

cat test_auth.log \
  | grep -E 'Failed|Invalid|authentication failure' \
  | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' \
  | sed -E 's/([0-9]+\.[0-9]+\.[0-9]+)\.[0-9]+/\1.x/g' \
  | sort | uniq -c | sort -nr | head -n 10
```

Результат:

>       2 192.168.1.x
>       1 172.16.254.x
>       1 10.0.0.x

**Вывод:**
Конвейер корректно находит источники неудачных логинов. Если в `auth.log` пусто — это тоже валидный результат.

**Использование ИИ:**
Поддержка в выборе регулярных выражений и маскировке IP через `sed`.


В) Установки пакетов (`dpkg.log`)
По `dpkg.log` определить TOP-10 пакетов по количеству установок.

Шаги/решение.

- Отобрать записи про установку.
- Извлечь имя пакета (без :arch).
- Посчитать частоту и отсортировать.
- Взять TOP-10.

```
cat /var/log/dpkg.log \
  | grep ' status installed ' \
  | awk '{print $5}' \
  | cut -d: -f1 \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

`cut` использован для наглядности, но можно заменить всё на `awk -F: '{print $1}'`

Результат:

>      15 libc-bin
>       7 man-db
>       5 initramfs-tools
>       4 systemd
>       4 sgml-base
>       4 libreoffice-common
>       3 udev
>       3 procps
>       3 linux-image-amd64
>       3 dbus

**Вывод:**
Чаще всего попадают базовые системные компоненты и зависимости

**Использование ИИ:**
Подсказки по выбору стабильного поля пакета


## Как это проверялось
- Последовательно запускались конвейеры 
- Для блока Б создан искусственный test_auth.log, чтобы убедиться в корректности регулярных выражений и маскировки.


## Итоги
Даже минимальный набор утилит (`grep, sed, awk, sort, uniq`) позволяет быстро получать метрики из логов: частотности токенов, источники неудачных логинов, топы установленных пакетов.

